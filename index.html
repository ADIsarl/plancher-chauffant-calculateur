<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculateur de Plancher Chauffant Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        @media (max-width: 1024px) {
            .content {
                grid-template-columns: 1fr;
            }
        }

        .section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #e9ecef;
        }

        .section h2 {
            color: #495057;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #495057;
            font-weight: 600;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: transform 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .room-item {
            background: white;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            border: 2px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .room-info {
            flex: 1;
        }

        .room-name {
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
        }

        .room-details {
            color: #6c757d;
            font-size: 0.9em;
        }

        .remove-room {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .remove-room:hover {
            background: #c82333;
        }

        .results {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-top: 30px;
        }

        .result-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .result-card h3 {
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .result-label {
            opacity: 0.9;
        }

        .result-value {
            font-weight: 600;
            font-size: 1.1em;
        }

        .warning {
            background: #fff3cd;
            border: 2px solid #ffc107;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .error {
            background: #f8d7da;
            border: 2px solid #dc3545;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .success {
            background: #d4edda;
            border: 2px solid #28a745;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .level-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .level-tab {
            padding: 10px 20px;
            background: #e9ecef;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .level-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .summary-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .summary-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .summary-label {
            color: #6c757d;
            margin-top: 5px;
        }

        .help-text {
            font-size: 0.85em;
            color: #6c757d;
            margin-top: 5px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
        }

        #exportBtn {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî• Calculateur de Plancher Chauffant Pro</h1>
            <p>Outil complet pour l'√©tude et le dimensionnement de plancher chauffant</p>
        </div>

        <div class="content">
            <div class="left-panel">
                <div class="section">
                    <h2>üìê Param√®tres G√©n√©raux</h2>
                    
                    <div class="form-group">
                        <label>Surface totale de la maison (m¬≤)</label>
                        <input type="number" id="totalArea" placeholder="Ex: 150" step="0.1">
                    </div>

                    <div class="form-group">
                        <label>D√©perdition totale (W)</label>
                        <input type="number" id="totalLoss" placeholder="Ex: 8000" step="10">
                        <div class="help-text">Puissance de chauffage n√©cessaire pour la maison</div>
                    </div>

                    <div class="form-group">
                        <label>Pas de pose (cm)</label>
                        <select id="spacing">
                            <option value="10">10 cm - Zones froides/SdB</option>
                            <option value="15" selected>15 cm - Standard</option>
                            <option value="20">20 cm - Zones temp√©r√©es</option>
                            <option value="25">25 cm - Faibles besoins</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Marge d'erreur tube (%)</label>
                        <input type="number" id="margin" value="10" min="5" max="25" step="1">
                        <div class="help-text">Marge pour les raccordements et courbes</div>
                    </div>

                    <div class="form-group">
                        <label>ŒîT (Diff√©rence temp√©rature d√©part/retour) ¬∞C</label>
                        <input type="number" id="deltaT" value="7" min="5" max="10" step="1">
                        <div class="help-text">Typiquement 5-10¬∞C pour plancher chauffant</div>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="corridorHeating" checked>
                        <label for="corridorHeating">Couloirs chauff√©s par passage des tubes</label>
                    </div>
                </div>

                <div class="section">
                    <h2>üè† Gestion des Pi√®ces</h2>
                    
                    <div class="level-selector" id="levelSelector">
                        <div class="level-tab active" data-level="0">RDC</div>
                        <button class="btn btn-secondary" onclick="addLevel()">+ Ajouter √©tage</button>
                    </div>

                    <div class="form-group">
                        <label>Nom de la pi√®ce</label>
                        <input type="text" id="roomName" placeholder="Ex: Salon">
                    </div>

                    <div class="form-group">
                        <label>Surface (m¬≤)</label>
                        <input type="number" id="roomArea" placeholder="Ex: 25" step="0.1">
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="isCorridor">
                        <label for="isCorridor">C'est un couloir/circulation</label>
                    </div>

                    <button class="btn" onclick="addRoom()">‚ûï Ajouter la pi√®ce</button>

                    <div id="roomsList" style="margin-top: 20px;"></div>
                </div>
            </div>

            <div class="right-panel">
                <div class="section">
                    <h2>üìä R√©sultats de l'√âtude</h2>
                    
                    <button class="btn btn-success" onclick="calculateAll()">üîÑ Calculer</button>
                    <button class="btn" id="exportBtn" onclick="exportResults()">üì• Exporter PDF</button>

                    <div id="results"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Structure de donn√©es pour stocker les informations
        let data = {
            levels: {
                0: { name: 'RDC', rooms: [] }
            },
            currentLevel: 0,
            globalParams: {}
        };

        // Fonction pour ajouter un niveau/√©tage
        function addLevel() {
            const levelCount = Object.keys(data.levels).length;
            const levelName = prompt(`Nom du niveau ${levelCount + 1}:`, `√âtage ${levelCount}`);
            if (levelName) {
                data.levels[levelCount] = { name: levelName, rooms: [] };
                updateLevelSelector();
                data.currentLevel = levelCount;
            }
        }

        // Mise √† jour du s√©lecteur de niveaux
        function updateLevelSelector() {
            const selector = document.getElementById('levelSelector');
            selector.innerHTML = '';
            
            Object.keys(data.levels).forEach(level => {
                const tab = document.createElement('div');
                tab.className = 'level-tab';
                if (parseInt(level) === data.currentLevel) {
                    tab.classList.add('active');
                }
                tab.dataset.level = level;
                tab.textContent = data.levels[level].name;
                tab.onclick = () => selectLevel(parseInt(level));
                selector.appendChild(tab);
            });

            const addBtn = document.createElement('button');
            addBtn.className = 'btn btn-secondary';
            addBtn.textContent = '+ Ajouter √©tage';
            addBtn.onclick = addLevel;
            selector.appendChild(addBtn);
        }

        // S√©lectionner un niveau
        function selectLevel(level) {
            data.currentLevel = level;
            updateLevelSelector();
            updateRoomsList();
        }

        // Ajouter une pi√®ce
        function addRoom() {
            const name = document.getElementById('roomName').value;
            const area = parseFloat(document.getElementById('roomArea').value);
            const isCorridor = document.getElementById('isCorridor').checked;

            if (!name || !area) {
                alert('Veuillez remplir tous les champs');
                return;
            }

            const room = {
                id: Date.now(),
                name: name,
                area: area,
                isCorridor: isCorridor,
                level: data.currentLevel
            };

            data.levels[data.currentLevel].rooms.push(room);
            
            // R√©initialiser les champs
            document.getElementById('roomName').value = '';
            document.getElementById('roomArea').value = '';
            document.getElementById('isCorridor').checked = false;
            
            updateRoomsList();
        }

        // Mettre √† jour la liste des pi√®ces
        function updateRoomsList() {
            const list = document.getElementById('roomsList');
            const rooms = data.levels[data.currentLevel].rooms;
            
            if (rooms.length === 0) {
                list.innerHTML = '<p style="color: #6c757d;">Aucune pi√®ce ajout√©e pour cet √©tage</p>';
                return;
            }

            list.innerHTML = '';
            rooms.forEach(room => {
                const item = document.createElement('div');
                item.className = 'room-item';
                
                const info = document.createElement('div');
                info.className = 'room-info';
                
                const name = document.createElement('div');
                name.className = 'room-name';
                name.textContent = room.name + (room.isCorridor ? ' (Couloir)' : '');
                
                const details = document.createElement('div');
                details.className = 'room-details';
                details.textContent = `Surface: ${room.area} m¬≤`;
                
                info.appendChild(name);
                info.appendChild(details);
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-room';
                removeBtn.textContent = '‚úï';
                removeBtn.onclick = () => removeRoom(room.id);
                
                item.appendChild(info);
                item.appendChild(removeBtn);
                list.appendChild(item);
            });
        }

        // Supprimer une pi√®ce
        function removeRoom(id) {
            data.levels[data.currentLevel].rooms = data.levels[data.currentLevel].rooms.filter(r => r.id !== id);
            updateRoomsList();
        }

        // Calcul de la longueur de tube pour une pi√®ce
        function calculateTubeLength(area, spacing, margin, isCorridor, corridorHeating) {
            if (isCorridor && corridorHeating) {
                // Les couloirs sont chauff√©s par le passage des tubes
                return 0;
            }
            
            const spacingM = spacing / 100; // Conversion cm en m
            const baseLength = area / spacingM;
            const marginFactor = 1 + (margin / 100);
            return baseLength * marginFactor;
        }

        // Calcul du d√©bit par circuit
        function calculateFlowRate(power, deltaT) {
            // Q = P / (c * ŒîT)
            // c = 4186 J/(kg¬∑K) pour l'eau
            // Conversion en l/min
            const c = 4186; // Capacit√© thermique de l'eau
            const flowKgS = power / (c * deltaT);
            const flowLMin = flowKgS * 60; // Conversion kg/s en l/min (densit√© eau ‚âà 1)
            return flowLMin;
        }

        // √âquilibrage des boucles dans une pi√®ce
        function balanceCircuits(tubeLength, maxCircuitLength = 120) {
            if (tubeLength <= maxCircuitLength) {
                return [tubeLength];
            }

            const numCircuits = Math.ceil(tubeLength / maxCircuitLength);
            const targetLength = tubeLength / numCircuits;
            
            // Cr√©er des circuits √©quilibr√©s
            const circuits = [];
            for (let i = 0; i < numCircuits; i++) {
                circuits.push(targetLength);
            }
            
            return circuits;
        }

        // Calcul du nombre de couronnes n√©cessaires
        function calculateCrowns(totalLength) {
            const crown240 = 240; // R√©f: A2KXW
            const crown120 = 120; // R√©f: 436LK
            
            let remaining = totalLength;
            let count240 = 0;
            let count120 = 0;
            
            // Optimisation : utiliser d'abord les grandes couronnes
            count240 = Math.floor(remaining / crown240);
            remaining = remaining % crown240;
            
            // Si le reste est sup√©rieur √† 120m, prendre une couronne de 240m de plus
            // pour √©viter d'avoir 2 couronnes de 120m
            if (remaining > crown120) {
                count240++;
                remaining = 0;
            } else if (remaining > 0) {
                count120 = 1;
            }
            
            return {
                crown240: count240,
                crown120: count120,
                totalCrowns: count240 + count120,
                waste: (count240 * crown240 + count120 * crown120) - totalLength
            };
        }

        // Calcul principal
        function calculateAll() {
            // R√©cup√©ration des param√®tres
            const totalArea = parseFloat(document.getElementById('totalArea').value);
            const totalLoss = parseFloat(document.getElementById('totalLoss').value);
            const spacing = parseFloat(document.getElementById('spacing').value);
            const margin = parseFloat(document.getElementById('margin').value);
            const deltaT = parseFloat(document.getElementById('deltaT').value);
            const corridorHeating = document.getElementById('corridorHeating').checked;

            if (!totalArea || !totalLoss) {
                alert('Veuillez renseigner la surface totale et la d√©perdition totale');
                return;
            }

            // Calcul par niveau
            let results = {
                levels: {},
                totalTubeLength: 0,
                totalActiveArea: 0,
                totalCircuits: 0,
                totalFlowRate: 0,
                nouriceSorties: 0,
                crowns: {},
                warnings: [],
                errors: []
            };

            let allCircuits = []; // Pour stocker tous les circuits et calculer le d√©bit total

            Object.keys(data.levels).forEach(levelKey => {
                const level = data.levels[levelKey];
                let levelResults = {
                    name: level.name,
                    rooms: [],
                    totalTubeLength: 0,
                    totalArea: 0,
                    totalActiveArea: 0,
                    circuits: []
                };

                // Calcul pour chaque pi√®ce du niveau
                level.rooms.forEach(room => {
                    const tubeLength = calculateTubeLength(room.area, spacing, margin, room.isCorridor, corridorHeating);
                    
                    const roomResult = {
                        name: room.name,
                        area: room.area,
                        isCorridor: room.isCorridor,
                        tubeLength: tubeLength,
                        circuits: []
                    };

                    levelResults.totalArea += room.area;
                    if (!room.isCorridor || !corridorHeating) {
                        levelResults.totalActiveArea += room.area;
                    }

                    // Gestion des circuits √©quilibr√©s
                    if (tubeLength > 0) {
                        const circuitLengths = balanceCircuits(tubeLength, 120);
                        const roomPowerPerM2 = totalLoss / totalArea; // W/m¬≤
                        const roomTotalPower = room.area * roomPowerPerM2; // W pour cette pi√®ce
                        
                        circuitLengths.forEach((circuitLength, index) => {
                            // Le d√©bit est proportionnel √† la longueur du circuit
                            // (plus de tube = plus de surface √† chauffer = plus de d√©bit n√©cessaire)
                            const circuitPower = roomTotalPower * (circuitLength / tubeLength);
                            const circuitFlow = calculateFlowRate(circuitPower, deltaT);

                            const circuit = {
                                id: `${room.name}-C${index + 1}`,
                                length: circuitLength,
                                power: circuitPower,
                                flowRate: circuitFlow
                            };

                            roomResult.circuits.push(circuit);
                            levelResults.circuits.push(circuit);
                            allCircuits.push(circuit);
                        });

                        if (circuitLengths.length > 1) {
                            results.warnings.push(`‚ö†Ô∏è Pi√®ce "${room.name}" divis√©e en ${circuitLengths.length} circuits √©quilibr√©s de ${circuitLengths[0].toFixed(0)}m`);
                        }
                    }

                    levelResults.totalTubeLength += tubeLength;
                    levelResults.rooms.push(roomResult);
                });

                results.levels[levelKey] = levelResults;
                results.totalTubeLength += levelResults.totalTubeLength;
                results.totalActiveArea += levelResults.totalActiveArea;
                results.totalCircuits += levelResults.circuits.length;
            });

            // Calcul du d√©bit total (somme des d√©bits de tous les circuits)
            results.totalFlowRate = allCircuits.reduce((sum, circuit) => sum + circuit.flowRate, 0);
            results.nouriceSorties = results.totalCircuits;

            // Calcul des couronnes n√©cessaires
            results.crowns = calculateCrowns(results.totalTubeLength);

            // V√©rifications
            const totalRoomArea = Object.values(data.levels).reduce((sum, level) => 
                sum + level.rooms.reduce((s, r) => s + r.area, 0), 0);

            if (Math.abs(totalRoomArea - totalArea) > 0.1) {
                results.warnings.push(`‚ö†Ô∏è Surface des pi√®ces (${totalRoomArea.toFixed(1)} m¬≤) ‚â† Surface totale (${totalArea} m¬≤)`);
            }

            const coverageRatio = (results.totalActiveArea / totalArea) * 100;
            if (coverageRatio < 80) {
                results.warnings.push(`‚ö†Ô∏è Couverture: ${coverageRatio.toFixed(1)}% (recommand√© > 80%)`);
            }

            // Affichage des r√©sultats
            displayResults(results);
        }

        // Affichage des r√©sultats
        function displayResults(results) {
            const resultsDiv = document.getElementById('results');
            let html = '';

            // R√©sum√© global
            html += '<div class="result-card">';
            html += '<h3>üìà R√©sum√© Global</h3>';
            html += '<div class="summary-grid">';
            html += `<div class="summary-item">
                        <div class="summary-value">${results.totalTubeLength.toFixed(0)} m</div>
                        <div class="summary-label">Longueur totale tube</div>
                     </div>`;
            html += `<div class="summary-item">
                        <div class="summary-value">${results.totalCircuits}</div>
                        <div class="summary-label">Circuits total</div>
                     </div>`;
            html += `<div class="summary-item">
                        <div class="summary-value">${results.totalFlowRate.toFixed(1)} l/min</div>
                        <div class="summary-label">D√©bit total</div>
                     </div>`;
            html += `<div class="summary-item">
                        <div class="summary-value">${results.nouriceSorties}</div>
                        <div class="summary-label">Sorties nourrice</div>
                     </div>`;
            html += '</div>';
            html += '</div>';

            // Informations sur les couronnes
            html += '<div class="result-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">';
            html += '<h3>üì¶ Besoins en Couronnes (Tube BAO 16x1.5)</h3>';
            html += '<div class="result-item">';
            html += `<span class="result-label">Couronnes 240m (r√©f: A2KXW):</span>`;
            html += `<span class="result-value">${results.crowns.crown240} couronne(s)</span>`;
            html += '</div>';
            html += '<div class="result-item">';
            html += `<span class="result-label">Couronnes 120m (r√©f: 436LK):</span>`;
            html += `<span class="result-value">${results.crowns.crown120} couronne(s)</span>`;
            html += '</div>';
            html += '<div class="result-item">';
            html += `<span class="result-label">Total couronnes:</span>`;
            html += `<span class="result-value">${results.crowns.totalCrowns} couronne(s)</span>`;
            html += '</div>';
            if (results.crowns.waste > 0) {
                html += '<div class="result-item">';
                html += `<span class="result-label">Chute de tube:</span>`;
                html += `<span class="result-value">${results.crowns.waste.toFixed(0)} m</span>`;
                html += '</div>';
            }
            html += '</div>';

            // D√©tails par niveau
            Object.keys(results.levels).forEach(levelKey => {
                const level = results.levels[levelKey];
                html += '<div class="section" style="margin-top: 20px;">';
                html += `<h2>üè¢ ${level.name}</h2>`;
                
                html += '<div class="result-item">';
                html += `<span class="result-label">Surface totale:</span>`;
                html += `<span class="result-value">${level.totalArea.toFixed(1)} m¬≤</span>`;
                html += '</div>';
                
                html += '<div class="result-item">';
                html += `<span class="result-label">Longueur tubes:</span>`;
                html += `<span class="result-value">${level.totalTubeLength.toFixed(0)} m</span>`;
                html += '</div>';

                // D√©tails par pi√®ce
                level.rooms.forEach(room => {
                    if (room.tubeLength > 0) {
                        html += `<div style="margin-top: 15px; padding-left: 20px;">`;
                        html += `<strong>${room.name}</strong> (${room.area} m¬≤)`;
                        html += `<div style="padding-left: 20px; margin-top: 5px;">`;
                        
                        room.circuits.forEach(circuit => {
                            html += `<div>‚Ä¢ Circuit ${circuit.id}: ${circuit.length.toFixed(0)}m - ${circuit.flowRate.toFixed(2)} l/min - ${circuit.power.toFixed(0)}W</div>`;
                        });
                        
                        html += `</div>`;
                        html += `</div>`;
                    } else if (room.isCorridor) {
                        html += `<div style="margin-top: 15px; padding-left: 20px; color: #6c757d;">`;
                        html += `<strong>${room.name}</strong> (${room.area} m¬≤) - Chauff√© par passage des tubes`;
                        html += `</div>`;
                    }
                });

                html += '</div>';
            });

            // Tableau r√©capitulatif des circuits
            if (results.totalCircuits > 0) {
                html += '<div class="section" style="margin-top: 20px;">';
                html += '<h2>üìã Tableau R√©capitulatif des Circuits</h2>';
                html += '<table style="width: 100%; border-collapse: collapse;">';
                html += '<thead>';
                html += '<tr style="background: #667eea; color: white;">';
                html += '<th style="padding: 10px; text-align: left;">Circuit</th>';
                html += '<th style="padding: 10px; text-align: center;">Longueur (m)</th>';
                html += '<th style="padding: 10px; text-align: center;">D√©bit (l/min)</th>';
                html += '<th style="padding: 10px; text-align: center;">Puissance (W)</th>';
                html += '</tr>';
                html += '</thead>';
                html += '<tbody>';
                
                let circuitIndex = 1;
                Object.values(results.levels).forEach(level => {
                    level.circuits.forEach(circuit => {
                        html += '<tr style="border-bottom: 1px solid #dee2e6;">';
                        html += `<td style="padding: 8px;">${circuitIndex}. ${circuit.id}</td>`;
                        html += `<td style="padding: 8px; text-align: center;">${circuit.length.toFixed(0)}</td>`;
                        html += `<td style="padding: 8px; text-align: center;">${circuit.flowRate.toFixed(2)}</td>`;
                        html += `<td style="padding: 8px; text-align: center;">${circuit.power.toFixed(0)}</td>`;
                        html += '</tr>';
                        circuitIndex++;
                    });
                });
                
                html += '</tbody>';
                html += '</table>';
                html += '</div>';
            }

            // Avertissements
            if (results.warnings.length > 0) {
                html += '<div class="warning">';
                html += '<strong>‚ö†Ô∏è Avertissements:</strong><br>';
                results.warnings.forEach(w => {
                    html += `‚Ä¢ ${w}<br>`;
                });
                html += '</div>';
            }

            // Erreurs
            if (results.errors.length > 0) {
                html += '<div class="error">';
                html += '<strong>‚ùå Erreurs:</strong><br>';
                results.errors.forEach(e => {
                    html += `‚Ä¢ ${e}<br>`;
                });
                html += '</div>';
            }

            // Message de succ√®s si tout est OK
            if (results.warnings.length === 0 && results.errors.length === 0) {
                html += '<div class="success">';
                html += '‚úÖ √âtude valid√©e - Tous les param√®tres sont conformes';
                html += '</div>';
            }

            resultsDiv.innerHTML = html;
        }

        // Export des r√©sultats
        function exportResults() {
            const results = document.getElementById('results').innerHTML;
            if (!results) {
                alert('Veuillez d\'abord calculer les r√©sultats');
                return;
            }

            // Cr√©ation d'un document imprimable
            const printWindow = window.open('', '', 'height=600,width=800');
            printWindow.document.write('<html><head><title>√âtude Plancher Chauffant</title>');
            printWindow.document.write('<style>');
            printWindow.document.write('body { font-family: Arial, sans-serif; padding: 20px; }');
            printWindow.document.write('.result-card { background: #f0f0f0; padding: 15px; margin: 10px 0; }');
            printWindow.document.write('.summary-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }');
            printWindow.document.write('.summary-item { text-align: center; padding: 10px; background: white; }');
            printWindow.document.write('.summary-value { font-size: 1.5em; font-weight: bold; }');
            printWindow.document.write('.warning { background: #fff3cd; padding: 10px; margin: 10px 0; }');
            printWindow.document.write('.success { background: #d4edda; padding: 10px; margin: 10px 0; }');
            printWindow.document.write('.section { background: #f8f9fa; padding: 15px; margin: 10px 0; }');
            printWindow.document.write('</style>');
            printWindow.document.write('</head><body>');
            printWindow.document.write('<h1>√âtude Plancher Chauffant - ' + new Date().toLocaleDateString('fr-FR') + '</h1>');
            
            // Ajout des param√®tres d'entr√©e
            printWindow.document.write('<div class="section">');
            printWindow.document.write('<h2>Param√®tres de l\'√©tude</h2>');
            printWindow.document.write(`<p>Surface totale: ${document.getElementById('totalArea').value} m¬≤</p>`);
            printWindow.document.write(`<p>D√©perdition totale: ${document.getElementById('totalLoss').value} W</p>`);
            printWindow.document.write(`<p>Pas de pose: ${document.getElementById('spacing').value} cm</p>`);
            printWindow.document.write(`<p>Marge: ${document.getElementById('margin').value} %</p>`);
            printWindow.document.write(`<p>ŒîT: ${document.getElementById('deltaT').value} ¬∞C</p>`);
            printWindow.document.write('</div>');
            
            printWindow.document.write(results);
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            printWindow.print();
        }

        // Initialisation
        updateRoomsList();
    </script>
</body>
</html>
